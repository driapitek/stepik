---
title: "Untitled"
output: html_document
editor_options: 
  chunk_output_type: console
---

# Корреляция и регрессиия

## Понятие корреляции

Есть три основных паттерна корреляции двух количественных признаков между собой

![Типы корреляции количественных переменных](img/correlation.png)

Выведем коэффициент корреляции

![Типы корреляции количественных переменных](img/coef_corr.png)

Чтобы получить коэффициент корреляции "как в учебниках" проделаем следующее

![Типы корреляции количественных переменных](img/corr_like_u4ebnik.png)

Cсылка на визуализацию использованную в этом уроке: <https://rpsychologist.com/d3/correlation/>

Крутая игра, в которой можно попробовать угадывать коэффициент корреляции <http://guessthecorrelation.com>

### Задача

Так как появилось две переменные, то для получения числа степеней свободы, нужно вычитать 2, а не один.

![Типы корреляции количественных переменных](img/exercise_correlation.png)

Но для визуализации мы возьмём тренировочные данные

```{r}
N <- 50
x <- rnorm(n = N, mean = 0, sd  = 1)
y <- rnorm(n = N, mean = 0, sd  = 1)
plot(x, y, lwd=5)
cor.test(x, y)
```

## Условие применения коэффициента корреляции

1. Характер взаимодействия --- линейный и монотонный. Более сложные зависимости не могут быть замечены этим коэффициентом


![Влияние нелинейных зависимостей на коэффициент корреляции Пирсона](img/regression12.png)

2. Характеристики переменных должны иметь нормальные распределения. Выбросы, ассиметрия, бимодальность --- критично влияет на коэффициент корреляции

![Влияние выбросов в данных](img/regression13.png)

3. Перед тем как считать линейный коэффициент корреляции Пирсона необходимо строить диаграммы рассеивания


## Непараметрический коэффициенты корреляции

1. Спирмана

2. Кендалла

Суть --- переход от реальных значений к ранжированным.

![Коэффициент корреляции Спирмана](img/spearman.png)

$d^2$ --- Разность рангов возведённая в квадрат

### Интерпретация

Ошибка корреляции --- наличие корреляции не обязательно означает причинно-следственную связь между переменными

Влияние третье переменной. Размер ноги школьника коррелирует со знанием математики. Но тут третья переменная --- возраст.

Показывает силу и направление.

Используем параметрический Пирсона --- если соблюдаются критерии нормальности, если нет переходи к непараметрическим Кендаллу или Спирману.

## Одномерный регрессионный анализ

Одномерным регрессионный анализ, позволяет проверять гипотезы о взаимосвязи одной  количественной зависимой переменной и нескольких независимых.

Сначала мы познакомимся с самым простым вариантом -  *простой линейной регрессией*, при помощи которой можно исследовать взаимосвязь *двух переменных*. Затем перейдем к множественной регрессии с несколькими независимыми переменными.


Базовое понятие --- линия регрессии

По игрику откладываем зависимую переменную. По иксу независимую переменную (предиктор).
Их суть --- как одна переменная позволяет предсказать, объяснить другую переменную.

Например, как зависит качество товара от его цены. Объект нашего интереса --- качество товара. А цена --- определяющий фактор.

Удобно изобразить линию --- линия проходила через самый центр рассеиваемых точек.

Каждая линия описывается формулой

![Коэффициент корреляции Спирмана](img/regression_line.png)


$b_0$ --- это свободный член, отвевчает за то где прямая линия пересекает ось `Y`

$b_1$ --- отвечает за направление, а так же за угол наклона которая прямая образует с осью `Х`

### Метод построения регрессионой прямой --- метод наименьших квадратов

![Коэффициент корреляции Спирмана](img/mnk.png)

Предположим у нас есть две линии *красная* и *синяя* и обе спорят за то, кто является прямой регрессии.

Остаток --- это расстояние от реального значения минус значение которое предсказывает регрессионая прямая.

Качество регрессионной прямой можно оценить, если возвести разность в квадрат.

МНК позволяет подобрать такую прямую, которая максимально близко находились к точкам.

![Коэффициент корреляции Спирмана](img/coeff_regr.png)

Если коэффициент корреляции равен нулю, т.е наши переменные никак не связаны, то коэффициент по приведённой выше формуле тоже $b_1$ равен нулю.

Тогда $b_0$ равен среднему по выборке. И чтобы проверять эту гипотезу, используется t-критерий.
Который говорит о том на сколько выборочное $b_1$ отклоняется от ожидаемого среднего. А так же проверяет гипотезу о том, что $b_1$ равен нулю

![Коэффициент корреляции Спирмана](img/b1.png)

Отклонив нулевую гипотезу, о том что $b_1 = 0$ мы можем сделать следующий вывод: Обнаружена значимая взаимосвязь двух переменных

Таким образом регрессионная модель позволяет построить модель взаимосвязи двух количественных переменных , проверить гипотезу о наличии взаимосвязи, расчитав соответствующий p-уровень значимости.

![Коэффициент корреляции Спирмана](img/b2.png)

При отсутствии корреляции прямая регрессии очень близка к прямой среднего значения. И тогда коэффциент детерминации очень близок к нулю. 

Напротив, если Есть очень хорошая корреляция, то разость суммы квадратов до прямой регрессии будет меньше чем разность суммы квадратов до прямой среднего значения.

Чем больше коэффициент детерминации, тем большая часть дисперсии зависимой переменной обусловлена взаимосвязью с независимой переменной

Если коэффициент детерминации равен нулю, то и коэффициент b1 (slope) также равен нулю

### Основные требования к регрессионому анализу

Для двух параметров.

1. Линейная взаимосвязь 

2. Нормальное распределение остатков 

3. Гомоскедастичность --- постоянная изменчивость остатков на всех уровнях независимой переменной

Посмотреть можно на этом приложении <https://gallery.shinyapps.io/slr_diag/>
